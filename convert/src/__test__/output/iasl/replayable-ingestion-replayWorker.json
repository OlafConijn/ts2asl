{
  "inputArgumentName": {
    "identifier": "input",
    "_syntaxKind": "identifier"
  },
  "statements": [
    {
      "name": {
        "identifier": "objects",
        "_syntaxKind": "identifier",
        "type": "object"
      },
      "expression": {
        "stateName": "ListObjectsV2",
        "resource": "arn:aws:states:::aws-sdk:s3:listObjectsV2",
        "parameters": {
          "properties": {
            "Prefix": {
              "identifier": "input.prefix",
              "type": "string",
              "_syntaxKind": "identifier"
            },
            "Bucket": {
              "value": "preprod-metrics-bucket-us-east-1",
              "type": "string",
              "_syntaxKind": "literal"
            }
          },
          "_syntaxKind": "literal-object"
        },
        "_syntaxKind": "asl-task-state"
      },
      "stateName": "Assign objects",
      "_syntaxKind": "variable-assignment"
    },
    {
      "name": {
        "identifier": "itemsWithKeys",
        "_syntaxKind": "identifier",
        "type": "object"
      },
      "expression": {
        "identifier": "objects.Contents",
        "type": "object",
        "_syntaxKind": "identifier",
        "filterExpression": {
          "argument": {
            "identifier": "item",
            "_syntaxKind": "identifier",
            "type": "object"
          },
          "expression": {
            "identifier": "item.Key",
            "type": "string",
            "_syntaxKind": "identifier"
          }
        }
      },
      "stateName": "Assign itemsWithKeys",
      "_syntaxKind": "variable-assignment"
    },
    {
      "name": {
        "identifier": "keys",
        "_syntaxKind": "identifier",
        "type": "object"
      },
      "expression": {
        "stateName": "For x Of itemsWithKeys.map",
        "items": {
          "identifier": "itemsWithKeys",
          "_syntaxKind": "identifier",
          "type": "object"
        },
        "iterator": {
          "inputArgumentName": {
            "identifier": "x",
            "_syntaxKind": "identifier"
          },
          "statements": [
            {
              "name": {
                "identifier": "return_var",
                "_syntaxKind": "identifier",
                "type": "unknown"
              },
              "expression": {
                "stateName": "Assign ???",
                "parameters": {
                  "identifier": "x.Key",
                  "type": "string",
                  "_syntaxKind": "identifier"
                },
                "_syntaxKind": "asl-pass-state"
              },
              "stateName": "Assign ???",
              "_syntaxKind": "variable-assignment"
            },
            {
              "expression": {
                "identifier": "return_var",
                "_syntaxKind": "identifier",
                "type": "unknown"
              },
              "_syntaxKind": "return",
              "stateName": "Return ???"
            }
          ],
          "_syntaxKind": "function"
        },
        "source": "itemsWithKeys.map(x => x.Key)",
        "_syntaxKind": "asl-map-state"
      },
      "stateName": "Assign keys",
      "_syntaxKind": "variable-assignment"
    },
    {
      "items": {
        "identifier": "keys",
        "_syntaxKind": "identifier",
        "type": "object"
      },
      "iterator": {
        "inputArgumentName": {
          "identifier": "key",
          "_syntaxKind": "identifier"
        },
        "statements": [
          {
            "name": {
              "identifier": "message",
              "_syntaxKind": "identifier",
              "type": "object"
            },
            "expression": {
              "stateName": "Assign message",
              "parameters": {
                "properties": {
                  "Records": {
                    "elements": [
                      {
                        "properties": {
                          "replay": {
                            "value": true,
                            "type": "boolean",
                            "_syntaxKind": "literal"
                          },
                          "eventSource": {
                            "value": "aws:s3",
                            "type": "string",
                            "_syntaxKind": "literal"
                          },
                          "awsRegion": {
                            "value": "us-east-1",
                            "type": "string",
                            "_syntaxKind": "literal"
                          },
                          "eventName": {
                            "value": "ObjectCreated:Put",
                            "type": "string",
                            "_syntaxKind": "literal"
                          },
                          "s3": {
                            "properties": {
                              "s3SchemaVersion": {
                                "value": "1.0",
                                "type": "string",
                                "_syntaxKind": "literal"
                              },
                              "bucket": {
                                "properties": {
                                  "name": {
                                    "value": "preprod-metrics-bucket-us-east-1",
                                    "type": "string",
                                    "_syntaxKind": "literal"
                                  },
                                  "arn": {
                                    "value": "arn:aws:s3:::preprod-metrics-bucket-us-east-1",
                                    "type": "string",
                                    "_syntaxKind": "literal"
                                  }
                                },
                                "_syntaxKind": "literal-object"
                              },
                              "object": {
                                "properties": {
                                  "key": {
                                    "identifier": "key",
                                    "_syntaxKind": "identifier",
                                    "type": "string"
                                  }
                                },
                                "_syntaxKind": "literal-object"
                              }
                            },
                            "_syntaxKind": "literal-object"
                          }
                        },
                        "_syntaxKind": "literal-object"
                      }
                    ],
                    "_syntaxKind": "literal-array"
                  }
                },
                "_syntaxKind": "literal-object"
              },
              "source": "message = {\n        Records: [\n          {\n            replay: true,\n            eventSource: \"aws:s3\",\n            awsRegion: \"us-east-1\",\n            eventName: \"ObjectCreated:Put\",\n            s3: {\n              s3SchemaVersion: \"1.0\",\n              bucket: {\n                name: \"preprod-metrics-bucket-us-east-1\",\n                arn: \"arn:aws:s3:::preprod-metrics-bucket-us-east-1\"\n              },\n              object: {\n                key: key\n              }\n            }\n          }\n        ]\n      }",
              "_syntaxKind": "asl-pass-state"
            },
            "stateName": "Assign message",
            "_syntaxKind": "variable-assignment"
          },
          {
            "stateName": "Publish",
            "resource": "arn:aws:states:::aws-sdk:sns:publish",
            "parameters": {
              "properties": {
                "TopicArn": {
                  "value": "arn:aws:sns:us-east-1:400780617693:CentralizedMetricsStream-preprod-CentralizedMetricsStreamTopic48052E47-1X7SNV6Y357H6",
                  "type": "string",
                  "_syntaxKind": "literal"
                },
                "Subject": {
                  "value": "Ingestion Replay S3",
                  "type": "string",
                  "_syntaxKind": "literal"
                },
                "Message": {
                  "arguments": [
                    {
                      "identifier": "message",
                      "_syntaxKind": "identifier",
                      "type": "object"
                    }
                  ],
                  "function": "asl.states.jsonToString",
                  "_syntaxKind": "asl-intrinsic-function"
                }
              },
              "_syntaxKind": "literal-object"
            },
            "_syntaxKind": "asl-task-state"
          }
        ],
        "_syntaxKind": "function"
      },
      "maxConcurrency": 5,
      "_syntaxKind": "asl-map-state"
    }
  ],
  "_syntaxKind": "statemachine"
}